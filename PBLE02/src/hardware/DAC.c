/*
 *  Created on: 5 de jul. de 2025
 *      Author: Osmar Bruno
 */

#include "../programa.h"

static unsigned int  viI;
static unsigned char vucIndice;

void iniciaDAC(void)
{
	LPC_SYSCTL->SYSAHBCLKCTRL |= (1<<16);

	LPC_IOCON->PIO0[4]         = 0x01;
	LPC_IOCON->PIO0[5]         = 0x01;

	LPC_SYSCTL->SYSAHBCLKCTRL |= (1<<5);
	LPC_SYSCTL->PRESETCTRL    |= (1<<1);

	LPC_I2C->SCLH 			   = 240;
	LPC_I2C->SCLL 			   = 240;

	LPC_I2C->CONSET			   |= (1<<6);
}

void definirDAC(uint16_t valor)
{
	if (valor > 4095) {
		valor = 4095;
	}

	uint8_t i2c_buffer[2];
	i2c_buffer[0] = (valor >> 8) & 0x0F;
	i2c_buffer[1] = valor & 0xFF;

	I2C_Transmitir(MCP4725_ENDERECO_I2C, i2c_buffer, 2);
}

void senoideDAC(void)
{
	static uint16_t guiAmostra[] = {
		   0,    3,   12,   27,   48,   75,  108,  147,
	     192,  242,  298,  359,  425,  496,  572,  652,
	     736,  824,  916, 1011, 1109, 1209, 1312, 1416,
	    1522, 1629, 1737, 1845, 1953, 2061, 2169, 2276,
	    2381, 2485, 2587, 2686, 2783, 2878, 2970, 3060,
	    3147, 3231, 3312, 3389, 3462, 3531, 3595, 3655,
	    3710, 3760, 3806, 3846, 3882, 3912, 3937, 3957,
	    3972, 3982, 3987, 3987, 3982, 3972, 3957, 3937,
	    3912, 3882, 3846, 3806, 3760, 3710, 3655, 3595,
	    3531, 3462, 3389, 3312, 3231, 3147, 3060, 2970,
	    2878, 2783, 2686, 2587, 2485, 2381, 2276, 2169,
	    2061, 1953, 1845, 1737, 1629, 1522, 1416, 1312,
	    1209, 1109, 1011,  916,  824,  736,  652,  572,
	     496,  425,  359,  298,  242,  192,  147,  108,
	      75,   48,   27,   12,    3,    0,    7,   18,
	      35,   58,   86,  120,  159,  203,  252,  306,
	     365,  428,  496,  568,  644,  723,  805,  891,
	     979, 1070, 1163, 1258, 1354, 1452, 1551, 1650,
	    1750, 1849, 1948, 2048, 2148, 2249, 2349, 2449,
		2548, 2646, 2742, 2837, 2930, 3022, 3111, 3198,
		3282, 3364, 3443, 3519, 3591, 3660, 3724, 3785,
		3842, 3894, 3942, 3985, 4023, 4056, 4083, 4105,
		4122, 4134, 4141, 4142, 4138, 4128, 4113, 4093,
		4067, 4036, 3999, 3958, 3911, 3859, 3803, 3742,
		3677, 3607, 3534, 3457, 3376, 3292, 3205, 3115,
		3022, 2927, 2829, 2730, 2628, 2525, 2420, 2314,
		2207, 2099, 1991, 1882, 1774, 1666, 1559, 1453,
		1348, 1245, 1144, 1045,  948,  854,  763,  675,
		 591,  510,  433,  361,  293,  230,  172,  120,
		  74,   35,    7,
	};

	definirDAC( guiAmostra[ vucIndice ] );

	vucIndice++;
	vucIndice &= 0x7F;
}
